<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utility Locating Report - GROUNDSCAN</title>
    <!-- Tailwind CSS CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .header {
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 16px;
            margin-bottom: 24px;
            text-align: center;
            display: flex; /* Added for flexbox layout */
            justify-content: space-between; /* Distribute items */
            align-items: center;
        }
        .section-header {
            background-color: #e2f0ff; /* Light blue background for section headers */
            color: #1e40af; /* Dark blue text */
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        .input-group {
            margin-bottom: 1rem;
        }
        /* Style for print mode */
        @media print {
            body {
                background-color: #fff;
                color: #000;
                margin: 0;
            }
            .container {
                max-width: 100%;
                margin: 0;
                padding: 0;
                box-shadow: none;
                border-radius: 0;
            }
            .header {
                border-bottom: 2px solid #000;
                margin-bottom: 10px;
            }
            .print\:hidden {
                display: none !important;
            }
            input, select, textarea {
                border: none !important;
                background-color: transparent !important;
                resize: none;
            }
            .input-label {
                font-weight: 600;
            }
            .no-print-border {
                border: none !important;
            }
            .logo-placeholder-text {
                /* Ensure text placeholder is visible if no image is supplied */
                border: 1px solid #ccc;
                padding: 4px;
                display: flex !important;
                align-items: center;
                justify-content: center;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container print:p-0">
        <!-- Header Section -->
        <header class="header">
            <!-- Company Logo -->
            <div id="companyLogoContainer" class="w-1/4 h-auto flex items-center justify-start min-h-[48px]">
                <img id="companyLogo" src="" alt="Company Logo" class="h-12 max-w-full object-contain hidden" onerror="this.classList.add('hidden'); document.getElementById('companyLogoText').classList.remove('hidden');">
                <div id="companyLogoText" class="logo-placeholder-text text-sm text-gray-500 border border-dashed p-2 hidden">COMPANY LOGO HERE</div>
            </div>

            <h1 class="text-xl sm:text-2xl font-bold text-gray-800 w-2/4 text-center">Utility Locating Report / QLB Memo</h1>
            
            <!-- Certification Logo -->
            <div id="certLogoContainer" class="w-1/4 h-auto flex items-center justify-end min-h-[48px]">
                <img id="certLogo" src="" alt="Certification Logo" class="h-12 max-w-full object-contain hidden" onerror="this.classList.add('hidden'); document.getElementById('certLogoText').classList.remove('hidden');">
                <div id="certLogoText" class="logo-placeholder-text text-sm text-gray-500 border border-dashed p-2 hidden">CERTIFICATION LOGO HERE</div>
            </div>
        </header>

        <!-- General Report Details -->
        <div class="section-header">Report Details</div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="input-group">
                <label for="companyName" class="input-label block text-sm font-medium text-gray-700">Company Name</label>
                <input type="text" id="companyName" placeholder="Your Company Name (e.g., GROUNDSCAN)" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 no-print-border">
            </div>
            <div class="input-group">
                <label for="reportDate" class="input-label block text-sm font-medium text-gray-700">Date of Report</label>
                <input type="date" id="reportDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 no-print-border">
            </div>
            
            <!-- NEW LOGO INPUTS -->
            <div class="input-group">
                <label for="companyLogoUrl" class="input-label block text-sm font-medium text-gray-700">Company Logo URL (Link)</label>
                <input type="text" id="companyLogoUrl" placeholder="Paste URL or Base64 here" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 no-print-border">
            </div>
            <div class="input-group">
                <label for="certLogoUrl" class="input-label block text-sm font-medium text-gray-700">Certification Logo URL (Link)</label>
                <input type="text" id="certLogoUrl" placeholder="Paste URL or Base64 here (e.g., CertLoc)" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 no-print-border">
            </div>
            <!-- END NEW LOGO INPUTS -->

            <div class="input-group">
                <label for="projectReference" class="input-label block text-sm font-medium text-gray-700">Client / Project Reference</label>
                <input type="text" id="projectReference" placeholder="Job No / Client Name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 no-print-border">
            </div>
            <div class="input-group">
                <label for="dbydReference" class="input-label block text-sm font-medium text-gray-700">BYDA Reference</label>
                <input type="text" id="dbydReference" placeholder="e.g., 51234567" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 no-print-border">
            </div>
            <div class="input-group">
                <label for="siteAddress" class="input-label block text-sm font-medium text-gray-700">Site Address</label>
                <textarea id="siteAddress" rows="1" placeholder="Street, Suburb, State, Postcode" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 no-print-border"></textarea>
            </div>
            <div class="input-group">
                <label for="locatingDate" class="input-label block text-sm font-medium text-gray-700">Date of Locating</label>
                <input type="date" id="locatingDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 no-print-border">
            </div>
            <div class="input-group">
                <label for="locateTech" class="input-label block text-sm font-medium text-gray-700">Locating Technician</label>
                <input type="text" id="locateTech" placeholder="Name and Cert No." class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 no-print-border">
            </div>
             <div class="input-group">
                <label for="dbydInquiryDate" class="input-label block text-sm font-medium text-gray-700">BYDA Inquiry Date</label>
                <input type="date" id="dbydInquiryDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 no-print-border">
            </div>
        </div>

        <!-- Locating Details -->
        <div class="section-header mt-8">Locating Activities and Findings</div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="input-group col-span-1 md:col-span-2">
                <label for="scopeOfWork" class="input-label block text-sm font-medium text-gray-700">Scope of Work</label>
                <textarea id="scopeOfWork" rows="3" placeholder="Brief description of the work performed (e.g., Locate utilities for proposed test bores/potholing)" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 no-print-border">Locate and mark all underground utilities within the designated areas for QLB test bore clearance, including conducting a blind search and verifying all BYDA plan assets.</textarea>
            </div>
            <div class="input-group col-span-1 md:col-span-2">
                <label for="equipmentUsed" class="input-label block text-sm font-medium text-gray-700">Equipment Used</label>
                <textarea id="equipmentUsed" rows="2" placeholder="e.g., Multi-frequency locator, GPR, GPS" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 no-print-border">Radiodetection RD8200/RD8100, Schonstedt GA-52Cx Magnetic Locator, MALA Easy Locator GPR, Survey-grade GPS/Total Station (if applicable).</textarea>
            </div>
            <div class="input-group">
                <label for="weather" class="input-label block text-sm font-medium text-gray-700">Weather Conditions</label>
                <input type="text" id="weather" placeholder="e.g., Fine, Sunny, 25°C" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 no-print-border">
            </div>
            <div class="input-group">
                <label for="surfaceConditions" class="input-label block text-sm font-medium text-gray-700">Surface Conditions</label>
                <input type="text" id="surfaceConditions" placeholder="e.g., Bitumen, Grass, Concrete" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 no-print-border">
            </div>
        </div>

        <!-- Utility Findings Section -->
        <div class="section-header mt-8">Utility Findings Summary (AS 5488 Quality Level)</div>
        <div id="utilityEntries" class="space-y-4">
            <!-- Utility entries will be added here -->
        </div>

        <div class="mt-6 print:hidden">
            <button id="addUtilityButton" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out">
                Add Utility Finding
            </button>
        </div>

        <!-- Conclusion / Recommendations -->
        <div class="section-header mt-8">Clearance and Recommendations</div>
        <div class="input-group">
            <label for="clearanceStatus" class="input-label block text-sm font-medium text-gray-700">Clearance Status</label>
            <textarea id="clearanceStatus" rows="3" placeholder="Provide a detailed summary of the findings, specific to the test bore locations cleared." class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 no-print-border">All utilities located have been clearly marked on the surface. Proposed test bore locations within the surveyed area are clear of identified services based on the non-destructive locating techniques used (QL-B). All proposed locations marked as 'CLEAR' are 500mm clear of the edge of the nearest located asset.</textarea>
        </div>
        <div class="input-group">
            <label for="recommendations" class="input-label block text-sm font-medium text-gray-700">Recommendations</label>
            <textarea id="recommendations" rows="3" placeholder="Mandatory recommendations for excavation." class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2 no-print-border">Potholing (QL-A) is required prior to any mechanical excavation within 1.5m of marked services. Hand digging is recommended for the first 500mm of excavation in areas marked as 'CLEAR'. This report is valid only for the scope of work and conditions present on the day of locating.</textarea>
        </div>


        <!-- Mandatory Disclaimer Section -->
        <div class="section-header mt-8 text-red-700 bg-red-100 border border-red-300">Mandatory Disclaimer (Appears on Printed Report)</div>
        <div id="disclaimer" class="p-4 text-sm text-gray-600 bg-gray-50 rounded-lg">
            <p class="font-bold text-base mb-2">IMPORTANT NOTICE: Quality Level B (QL-B)</p>
            <p>This report has been prepared by <span id="disclaimerCompanyName" class="font-bold text-gray-800"></span> using non-destructive utility locating techniques (electromagnetic, GPR, etc.), which conform to Quality Level B (QL-B) of AS 5488-2019.</p>
            <ul class="list-disc list-inside mt-2 space-y-1">
                <li><span class="font-semibold">QL-B Accuracy:</span> Asset positions marked are typically within 300mm horizontally. Depth is indicative only and not guaranteed.</li>
                <li><span class="font-semibold">Verification Required (QL-A):</span> The exact position of all identified services MUST be verified by Potholing (Quality Level A) prior to any mechanical excavation within the tolerance zone.</li>
                <li><span class="font-semibold">Unidentified Services:</span> <span id="disclaimerCompanyName2" class="font-bold text-gray-800"></span> accepts no responsibility for unlocatable or unidentified services.</li>
            </ul>
        </div>


        <!-- Action Buttons -->
        <div class="mt-8 flex justify-center space-x-4 print:hidden">
            <button id="printReportButton" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-150 ease-in-out transform hover:scale-105">
                Generate/Print Report (PDF)
            </button>
        </div>
    </div>

    <script>
        // Data structure for utility entries
        const utilityTemplate = {
            assetType: '',
            method: 'EML (Inductive/Conductive) / GPR',
            depth: '',
            accuracy: 'QL-B (±300mm Horizontal)',
            comments: 'Clear markings provided on surface.',
            remove: false
        };

        let utilityCounter = 0;

        /**
         * Generates the dropdown options for utility accuracy based on AS 5488.
         */
        function generateAccuracyOptions() {
            const accuracyOptions = [
                { value: "QL-A", label: "QL-A (Potholing - Exact Position)" },
                { value: "QL-B", label: "QL-B (±300mm Horizontal - Non-Destructive)" },
                { value: "QL-C", label: "QL-C (Visual Site Evidence/Sketch)" },
                { value: "QL-D", label: "QL-D (BYDA Plans/Existing Records)" }
            ];

            return accuracyOptions.map(option =>
                `<option value="${option.value}">${option.label}</option>`
            ).join('');
        }

        /**
         * Adds a new utility finding entry to the form.
         * @param {Object} [data=utilityTemplate] - Initial data for the entry.
         */
        function addUtilityEntry(data = utilityTemplate) {
            utilityCounter++;
            const entryId = `utility-${utilityCounter}`;
            const utilityEntriesContainer = document.getElementById('utilityEntries');

            const newEntry = document.createElement('div');
            newEntry.classList.add('utility-entry', 'p-4', 'border', 'border-gray-200', 'rounded-lg', 'bg-white', 'relative', 'grid', 'grid-cols-1', 'sm:grid-cols-2', 'md:grid-cols-4', 'gap-4');
            newEntry.id = entryId;

            newEntry.innerHTML = `
                <div class="input-group md:col-span-1">
                    <label class="input-label block text-xs font-medium text-gray-500">Asset Type</label>
                    <input type="text" value="${data.assetType}" placeholder="e.g., Telstra Fibre Optic" class="asset-type-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 text-sm no-print-border">
                </div>
                <div class="input-group md:col-span-1">
                    <label class="input-label block text-xs font-medium text-gray-500">Locating Method</label>
                    <input type="text" value="${data.method}" class="method-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 text-sm no-print-border">
                </div>
                <div class="input-group md:col-span-1">
                    <label class="input-label block text-xs font-medium text-gray-500">Indicated Depth (m)</label>
                    <input type="text" value="${data.depth}" placeholder="e.g., 0.6m or U/K" class="depth-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 text-sm no-print-border">
                </div>
                <div class="input-group md:col-span-1">
                    <label class="input-label block text-xs font-medium text-gray-500">AS 5488 Quality Level</label>
                    <select class="accuracy-select mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 text-sm no-print-border">
                        ${generateAccuracyOptions()}
                    </select>
                </div>
                <div class="input-group md:col-span-4">
                    <label class="input-label block text-xs font-medium text-gray-500">Comments / Markings</label>
                    <input type="text" value="${data.comments}" placeholder="e.g., Marked with Telstra pink line and asset tags." class="comments-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 text-sm no-print-border">
                </div>
                <button type="button" class="remove-utility-btn bg-red-500 hover:bg-red-600 text-white text-xs py-1 px-2 rounded absolute top-2 right-2 print:hidden">
                    Remove
                </button>
            `;

            const selectElement = newEntry.querySelector('.accuracy-select');
            selectElement.value = data.accuracy.split('(')[0].trim(); // Set QL-B as default

            const removeButton = newEntry.querySelector('.remove-utility-btn');
            removeButton.addEventListener('click', () => {
                newEntry.remove();
            });

            utilityEntriesContainer.appendChild(newEntry);
        }

        /**
         * Collects all form data into a structured object.
         */
        function collectFormData() {
            const utilities = Array.from(document.querySelectorAll('.utility-entry')).map(entry => {
                return {
                    assetType: entry.querySelector('.asset-type-input').value,
                    method: entry.querySelector('.method-input').value,
                    depth: entry.querySelector('.depth-input').value,
                    accuracy: entry.querySelector('.accuracy-select').value,
                    comments: entry.querySelector('.comments-input').value
                };
            });

            return {
                companyName: document.getElementById('companyName').value,
                reportDate: document.getElementById('reportDate').value,
                companyLogoUrl: document.getElementById('companyLogoUrl').value,
                certLogoUrl: document.getElementById('certLogoUrl').value,
                projectReference: document.getElementById('projectReference').value,
                dbydReference: document.getElementById('dbydReference').value,
                siteAddress: document.getElementById('siteAddress').value,
                locatingDate: document.getElementById('locatingDate').value,
                dbydInquiryDate: document.getElementById('dbydInquiryDate').value,
                locateTech: document.getElementById('locateTech').value,
                scopeOfWork: document.getElementById('scopeOfWork').value,
                equipmentUsed: document.getElementById('equipmentUsed').value,
                weather: document.getElementById('weather').value,
                surfaceConditions: document.getElementById('surfaceConditions').value,
                clearanceStatus: document.getElementById('clearanceStatus').value,
                recommendations: document.getElementById('recommendations').value,
                utilities: utilities
            };
        }

        /**
         * Populates the report fields from storage on load.
         */
        function loadReportData() {
            try {
                const storedData = JSON.parse(localStorage.getItem('utilityLocatingReportData'));
                if (storedData) {
                    document.getElementById('companyName').value = storedData.companyName || '';
                    document.getElementById('reportDate').value = storedData.reportDate || '';
                    document.getElementById('companyLogoUrl').value = storedData.companyLogoUrl || '';
                    document.getElementById('certLogoUrl').value = storedData.certLogoUrl || '';
                    document.getElementById('projectReference').value = storedData.projectReference || '';
                    document.getElementById('dbydReference').value = storedData.dbydReference || '';
                    document.getElementById('siteAddress').value = storedData.siteAddress || '';
                    document.getElementById('locatingDate').value = storedData.locatingDate || '';
                    document.getElementById('dbydInquiryDate').value = storedData.dbydInquiryDate || '';
                    document.getElementById('locateTech').value = storedData.locateTech || '';
                    document.getElementById('scopeOfWork').value = storedData.scopeOfWork || '';
                    document.getElementById('equipmentUsed').value = storedData.equipmentUsed || '';
                    document.getElementById('weather').value = storedData.weather || '';
                    document.getElementById('surfaceConditions').value = storedData.surfaceConditions || '';
                    document.getElementById('clearanceStatus').value = storedData.clearanceStatus || '';
                    document.getElementById('recommendations').value = storedData.recommendations || '';

                    // Clear existing utility entries before loading
                    document.getElementById('utilityEntries').innerHTML = '';

                    // Load utility entries
                    if (storedData.utilities && storedData.utilities.length > 0) {
                        storedData.utilities.forEach(addUtilityEntry);
                    } else {
                        addUtilityEntry({ assetType: 'None Located in Survey Area', method: 'Blind Search & EML Sweep', depth: 'N/A', accuracy: 'QL-B (±300mm Horizontal)', comments: 'Area marked as CLEAR.' });
                    }
                } else {
                     // Default: Add one empty entry if no data is found
                    addUtilityEntry({ assetType: 'None Located in Survey Area', method: 'Blind Search & EML Sweep', depth: 'N/A', accuracy: 'QL-B (±300mm Horizontal)', comments: 'Area marked as CLEAR.' });
                }
            } catch (e) {
                console.error("Error loading report data from localStorage:", e);
                addUtilityEntry({ assetType: 'None Located in Survey Area', method: 'Blind Search & EML Sweep', depth: 'N/A', accuracy: 'QL-B (±300mm Horizontal)', comments: 'Area marked as CLEAR.' });
            }
        }

        /**
         * Saves all form data to storage.
         */
        function saveReportData() {
            const data = collectFormData();
            localStorage.setItem('utilityLocatingReportData', JSON.stringify(data));
        }

        /**
         * Updates the header logos based on the input URLs.
         */
        function updateLogos() {
            const companyUrlInput = document.getElementById('companyLogoUrl');
            const certUrlInput = document.getElementById('certLogoUrl');
            const companyImg = document.getElementById('companyLogo');
            const certImg = document.getElementById('certLogo');
            const companyText = document.getElementById('companyLogoText');
            const certText = document.getElementById('certLogoText');

            // --- Company Logo Logic ---
            const companyUrl = companyUrlInput.value.trim();
            if (companyUrl) {
                companyImg.src = companyUrl;
                companyImg.classList.remove('hidden');
                companyText.classList.add('hidden');
            } else {
                companyImg.src = ''; // Clear source
                companyImg.classList.add('hidden');
                companyText.classList.remove('hidden');
            }
            
            // Re-run onerror in case the URL was invalid
            companyImg.onerror = function() { 
                companyImg.classList.add('hidden'); 
                companyText.classList.remove('hidden');
                companyImg.src = '';
            };
            
            // --- Certification Logo Logic ---
            const certUrl = certUrlInput.value.trim();
            if (certUrl) {
                certImg.src = certUrl;
                certImg.classList.remove('hidden');
                certText.classList.add('hidden');
            } else {
                certImg.src = ''; // Clear source
                certImg.classList.add('hidden');
                certText.classList.remove('hidden');
            }

            // Re-run onerror in case the URL was invalid
            certImg.onerror = function() { 
                certImg.classList.add('hidden'); 
                certText.classList.remove('hidden');
                certImg.src = '';
            };

            // Trigger load to refresh image display
            if (companyUrl) companyImg.src = companyUrl;
            if (certUrl) certImg.src = certUrl;
        }

        window.onload = function() {
            // Load and initialize data
            loadReportData();

            // Set today's date on load for convenience if fields are empty
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0'); // Month is 0-indexed, so we add 1
            const dd = String(today.getDate()).padStart(2, '0');
            const formattedDate = `${yyyy}-${mm}-${dd}`;
            
            if (!document.getElementById('reportDate').value) document.getElementById('reportDate').value = formattedDate;
            if (!document.getElementById('locatingDate').value) document.getElementById('locatingDate').value = formattedDate;
            if (!document.getElementById('dbydInquiryDate').value) document.getElementById('dbydInquiryDate').value = formattedDate; 

            // Initial logo update
            updateLogos();

            // Set default company name in disclaimer for initial load and update dynamically
            const companyNameInput = document.getElementById('companyName');
            const updateCompanyNameInDisclaimers = function() {
                const currentCompanyName = companyNameInput.value || companyNameInput.placeholder.replace('Your Company Name (e.g., ', '').replace(')', '');
                // Update the hidden spans in the disclaimer for the generated report
                document.getElementById('disclaimerCompanyName').textContent = currentCompanyName;
                document.getElementById('disclaimerCompanyName2').textContent = currentCompanyName;
            };

            // Initial call to set company name in disclaimers
            updateCompanyNameInDisclaimers();

            // --- Event Listeners ---
            document.getElementById('addUtilityButton').addEventListener('click', () => addUtilityEntry(utilityTemplate));
            document.getElementById('printReportButton').addEventListener('click', () => {
                saveReportData(); // Save before printing
                window.print();
            });

            // Listen for changes on all form inputs to save data
            document.querySelector('.container').addEventListener('input', (e) => {
                if (e.target.tagName !== 'BUTTON') {
                    saveReportData();
                }
            });

            // Listen for changes to the company name input and logo inputs
            companyNameInput.addEventListener('input', updateCompanyNameInDisclaimers);
            document.getElementById('companyLogoUrl').addEventListener('input', updateLogos);
            document.getElementById('certLogoUrl').addEventListener('input', updateLogos);
        };
    </script>
</body>
</html>